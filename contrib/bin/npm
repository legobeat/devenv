#!/bin/bash
export RUNNER_IMAGE="${NPM_RUNNER_IMAGE:-${NODE_RUNNER_IMAGE:-${RUNNER_IMAGE}}}"
export RUNNER_ENV="${RUNNER_ENV}"
export RUNNER_OPTS="${RUNNER_OPTS}"
if [[ -n "${L7_NODE_CACHE_DIR}" ]]; then
  export RUNNER_VOLS="${L7_NODE_CACHE_DIR}/npm/cache:/home/node/.npm/_cacache ${RUNNER_VOLS}"
elif [[ -n "${L7_NPM_CACHE_VOLUME}" ]]; then
  export RUNNER_VOLS="${L7_NPM_CACHE_VOLUME}:/home/node/.npm/_cacache ${RUNNER_VOLS}"
fi
if [[ -n "${NPM_VERSION}" ]]; then
  exec l7-run-node "/home/node/.cache/node/corepack/v1/npm/${NPM_VERSION}/bin/npm" ${@}
else
  exec l7-run-node npm ${@}
fi
